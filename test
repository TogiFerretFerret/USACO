We can use Boruvka's algorithm to solve this problem.

This algorithm usually works in : initially MST is empty, and then we run a number of iterations. During each iteration we find connected components in the graph formed by already added edges, and for each component we find the shortest edge that leads out of this component. Then we add the edges we found to the MST (but we should be careful to avoid adding edges that form cycles in MST). The number of iterations is at most , and each of iterations can be done in O(m).

However, in this problem we need to speed up this algorithm. We can do each iteration in time using a binary trie. We can store all values from a in a trie. When we need to find the shortest edge that connects some component with vertices outside of it, we firstly remove all values contained in this component from the trie. After that, for each vertex in the component we can find the closest vertex outside the component in by descending the trie. And then we insert the values of ai belonging to the component back into the trie. Since for each vertex we descend the trie three times (to remove it, to find closest vertex and to add it back), each iteration requries , and the whole algorithm works in time.
